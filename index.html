<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PNGC Caddie V17</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a4314">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#1a4314]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const COURSE_DATA = {
            Blue: [364, 195, 509, 557, 393, 192, 361, 452, 385, 364, 399, 516, 173, 512, 325, 363, 173, 384],
            White: [356, 174, 474, 486, 377, 170, 345, 429, 368, 346, 386, 495, 155, 485, 311, 351, 158, 364],
            Yellow: [320, 140, 420, 430, 330, 140, 310, 380, 330, 310, 340, 440, 130, 430, 280, 310, 130, 330],
            Pars: [4, 3, 5, 5, 4, 3, 4, 4, 4, 4, 4, 5, 3, 5, 4, 4, 3, 4]
        };

        const CLUBS = ['Driver', '3 Wood', '5 Wood', '3 Iron', '4 Iron', '5 Iron', '6 Iron', '7 Iron', '8 Iron', '9 Iron', 'PW', 'SW'];

        function App() {
            const [view, setView] = useState('setup');
            const [tee, setTee] = useState('White');
            const [numHoles, setNumHoles] = useState(18);
            const [handicap, setHandicap] = useState(18);
            const [holeIdx, setHoleIdx] = useState(0);
            const [scores, setScores] = useState(new Array(18).fill(0));
            const [startCoords, setStartCoords] = useState(null);
            const [walkedDist, setWalkedDist] = useState(0);
            const [showClubMenu, setShowClubMenu] = useState(false);
            const [menuMode, setMenuMode] = useState('save');
            const [manualClub, setManualClub] = useState(null);
            
            const [clubData, setClubData] = useState(() => {
                const saved = localStorage.getItem('pngc_v17');
                return saved ? JSON.parse(saved) : CLUBS.map((l, i) => ({ label: l, dist: 210 - (i * 12) }));
            });

            useEffect(() => { localStorage.setItem('pngc_v17', JSON.stringify(clubData)); }, [clubData]);

            useEffect(() => {
                let watchId;
                if (startCoords) {
                    watchId = navigator.geolocation.watchPosition((pos) => {
                        const R = 6371e3; 
                        const dLat = (pos.coords.latitude - startCoords.lat) * Math.PI / 180;
                        const dLon = (pos.coords.longitude - startCoords.lon) * Math.PI / 180;
                        const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(startCoords.lat * Math.PI/180) * Math.cos(pos.coords.latitude * Math.PI/180) * Math.sin(dLon/2) * Math.sin(dLon/2);
                        setWalkedDist(Math.round(2 * R * Math.atan2(Math.sqrt(a), Math.sqrt(1-a))));
                    }, null, { enableHighAccuracy: true });
                }
                return () => navigator.geolocation.clearWatch(watchId);
            }, [startCoords]);

            const getClubSuggestion = () => {
                if (manualClub) return manualClub;
                const distToHole = COURSE_DATA[tee][holeIdx] + (handicap * 0.3);
                const pick = [...clubData].sort((a,b) => a.dist - b.dist).find(c => c.dist >= distToHole);
                return pick ? pick.label : "Driver";
            };

            const resetGame = () => {
                setScores(new Array(18).fill(0));
                setHoleIdx(0);
                setView('setup');
            };

            if (view === 'setup') {
                return (
                    <div className="flex flex-col items-center justify-center p-8 min-h-screen text-white">
                        <h1 className="text-4xl font-black mb-10 text-yellow-400 italic tracking-tighter">PNGC CADDIE</h1>
                        <div className="w-full max-w-xs space-y-6">
                            <div className="flex bg-white/10 rounded-xl p-1">
                                {[9, 18].map(n => (
                                    <button key={n} onClick={() => setNumHoles(n)} className={`flex-1 py-3 rounded-lg font-bold transition-all ${numHoles === n ? 'bg-yellow-400 text-black' : 'text-white/60'}`}>{n} Holes</button>
                                ))}
                            </div>
                            <div className="grid grid-cols-3 gap-2">
                                {['Blue', 'White', 'Yellow'].map(t => (
                                    <button key={t} onClick={() => setTee(t)} className={`py-4 rounded-xl font-bold border-2 ${tee === t ? 'bg-white text-green-900 border-white' : 'bg-white/5 border-white/20'}`}>{t}</button>
                                ))}
                            </div>
                            <div className="bg-white/5 p-4 rounded-2xl text-center">
                                <p className="text-xs font-bold mb-2 opacity-50 uppercase tracking-widest">Handicap: {handicap}</p>
                                <input type="range" min="0" max="54" value={handicap} onChange={e => setHandicap(parseInt(e.target.value))} className="w-full accent-yellow-400" />
                            </div>
                            <button onClick={() => setView('play')} className="w-full bg-yellow-400 text-green-900 py-5 rounded-2xl font-black text-xl shadow-lg">START ROUND</button>
                        </div>
                    </div>
                );
            }

            if (view === 'scorecard') {
                const totalPar = COURSE_DATA.Pars.slice(0, numHoles).reduce((a,b) => a+b, 0);
                const totalScore = scores.slice(0, numHoles).reduce((a,b) => a+b, 0);
                const diff = totalScore - totalPar;

                return (
                    <div className="min-h-screen bg-gray-100 p-4 pb-12 overflow-y-auto">
                        <div className="bg-[#1a4314] text-white p-6 rounded-[30px] mb-4 text-center">
                            <h2 className="text-3xl font-black italic text-yellow-400">ROUND SUMMARY</h2>
                            <p className="text-sm opacity-60 uppercase font-bold tracking-widest">{numHoles} Holes • {tee} Tees</p>
                        </div>

                        <div className="bg-white rounded-3xl shadow-xl overflow-hidden mb-6">
                            <table className="w-full text-center">
                                <thead className="bg-gray-200 text-[10px] font-bold text-gray-500 uppercase">
                                    <tr>
                                        <th className="py-3">Hole</th>
                                        <th className="py-3">Par</th>
                                        <th className="py-3">Score</th>
                                        <th className="py-3">+/-</th>
                                    </tr>
                                </thead>
                                <tbody className="text-lg font-black text-green-900">
                                    {scores.slice(0, numHoles).map((s, i) => {
                                        const par = COURSE_DATA.Pars[i];
                                        const over = s === 0 ? 0 : s - par;
                                        return (
                                            <tr key={i} className="border-b border-gray-50">
                                                <td className="py-3 text-gray-400 font-bold">{i+1}</td>
                                                <td className="py-3">{par}</td>
                                                <td className="py-3">{s === 0 ? '-' : s}</td>
                                                <td className={`py-3 ${over > 0 ? 'text-red-500' : over < 0 ? 'text-blue-500' : 'text-gray-300'}`}>
                                                    {over > 0 ? `+${over}` : over === 0 ? 'E' : over}
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>

                        <div className="bg-white p-6 rounded-[30px] shadow-lg text-center border-t-8 border-yellow-400">
                            <p className="text-xs font-bold text-gray-400 uppercase">Final Score</p>
                            <h3 className="text-6xl font-black text-green-900">{totalScore}</h3>
                            <p className={`text-xl font-bold ${diff > 0 ? 'text-red-500' : 'text-blue-500'}`}>
                                {diff > 0 ? `+${diff}` : diff === 0 ? 'Even Par' : diff}
                            </p>
                            <button onClick={resetGame} className="mt-8 w-full bg-black text-white py-5 rounded-2xl font-black uppercase tracking-widest">New Round</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="bg-gray-100 min-h-screen flex flex-col items-center text-black">
                    <div className="w-full bg-[#1a4314] p-6 text-white text-center rounded-b-[40px] shadow-xl">
                        <div className="flex justify-between items-center mb-1">
                            <p className="text-[10px] font-bold opacity-50 uppercase tracking-widest">Hole {holeIdx+1} • {tee}</p>
                            <p className="text-[10px] font-bold bg-white/20 px-2 py-1 rounded">PAR {COURSE_DATA.Pars[holeIdx]}</p>
                        </div>
                        <h2 className="text-7xl font-black my-2 leading-none">{COURSE_DATA[tee][holeIdx]}m</h2>
                        <button onClick={() => { setMenuMode('change'); setShowClubMenu(true); }} className="bg-yellow-400 text-black px-6 py-2 rounded-full font-black uppercase italic shadow-lg">
                            Take: {getClubSuggestion()} ✍️
                        </button>
                    </div>

                    <div className="w-full p-4 space-y-4 max-w-md">
                        <div className="bg-white p-6 rounded-[35px] shadow-sm text-center border-2 border-gray-200">
                            <p className="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1">Live Tracking</p>
                            <p className="text-7xl font-black text-green-900">{walkedDist}m</p>
                            {!startCoords ? (
                                <button onClick={() => navigator.geolocation.getCurrentPosition(p => setStartCoords({lat: p.coords.latitude, lon: p.coords.longitude}))} className="w-full mt-4 bg-green-900 text-white py-5 rounded-2xl font-black uppercase tracking-widest shadow-lg">Start Tracker</button>
                            ) : (
                                <button onClick={() => { setMenuMode('save'); setShowClubMenu(true); }} className="w-full mt-4 bg-yellow-500 text-white py-5 rounded-2xl font-black uppercase tracking-widest shadow-lg animate-pulse">Save Distance</button>
                            )}
                        </div>

                        <div className="bg-white p-4 rounded-[30px] shadow-sm flex justify-between items-center px-8 border border-gray-100">
                            <button onClick={() => {let n=[...scores]; n[holeIdx]=Math.max(0, n[holeIdx]-1); setScores(n)}} className="text-6xl text-gray-200">-</button>
                            <div className="text-center leading-none">
                                <p className="text-[10px] font-bold text-gray-400 uppercase">Strokes</p>
                                <p className="text-6xl font-black text-green-900">{scores[holeIdx]}</p>
                            </div>
                            <button onClick={() => {let n=[...scores]; n[holeIdx]++; setScores(n)}} className="w-16 h-16 bg-green-900 text-white rounded-full text-4xl font-bold active:scale-90 transition-transform shadow-lg">+</button>
                        </div>
                    </div>

                    <div className="mt-auto w-full grid grid-cols-2 gap-2 p-4 pb-8">
                        <button onClick={() => alert(clubData.map(c=>`${c.label}: ${c.dist}m`).join('\n'))} className="bg-white py-5 rounded-2xl text-[10px] font-bold uppercase text-gray-400 border border-gray-200">View My Bag</button>
                        <button onClick={() => {
                            if (holeIdx + 1 >= numHoles) {
                                setView('scorecard');
                            } else {
                                setManualClub(null); setStartCoords(null); setWalkedDist(0); setHoleIdx(holeIdx+1);
                            }
                        }} className="bg-black text-white py-5 rounded-2xl font-black text-[10px] uppercase tracking-widest">
                            {holeIdx + 1 >= numHoles ? "VIEW SCORECARD" : "NEXT HOLE"}
                        </button>
                    </div>

                    {showClubMenu && (
                        <div className="fixed inset-0 z-50 bg-black/90 flex flex-col justify-end">
                            <div className="bg-white rounded-t-[40px] p-6 pb-12 overflow-y-auto max-h-[80vh]">
                                <p className="text-center text-xs font-bold text-gray-400 uppercase mb-8 tracking-widest">Select Club</p>
                                <div className="grid grid-cols-3 gap-2">
                                    {CLUBS.map(c => (
                                        <button key={c} onClick={() => {
                                            if (menuMode === 'save') {
                                                setClubData(prev => prev.map(club => (club.label === c && walkedDist > club.dist) ? {...club, dist: walkedDist} : club));
                                                setStartCoords(null); setWalkedDist(0);
                                            } else { setManualClub(c); }
                                            setShowClubMenu(false);
                                        }} className="bg-gray-100 py-5 rounded-2xl font-black text-[10px] uppercase text-green-900 active:bg-yellow-400">{c}</button>
                                    ))}
                                </div>
                                <button onClick={() => setShowClubMenu(false)} className="w-full mt-6 text-gray-400 font-bold uppercase text-xs">Cancel</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
