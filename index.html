<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PNGC Smart Caddie</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .golf-green { background-color: #1a4314; }
        .distance-card { background: linear-gradient(145deg, #1a4314, #2d5a22); }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const COURSE_DIST = [364, 195, 509, 557, 393, 192, 361, 452, 385, 364, 399, 516, 173, 512, 325, 363, 173, 384];

        // Default distances if you have no history yet
        const DEFAULT_CLUBS = [
            { label: 'Driver', dist: 220 }, { label: '3 Wood', dist: 200 },
            { label: '5 Wood', dist: 185 }, { label: '4 Iron', dist: 170 },
            { label: '5 Iron', dist: 160 }, { label: '6 Iron', dist: 150 },
            { label: '7 Iron', dist: 140 }, { label: '8 Iron', dist: 130 },
            { label: '9 Iron', dist: 120 }, { label: 'PW', dist: 110 }, { label: 'SW', dist: 90 }
        ];

        function App() {
            const [holeIdx, setHoleIdx] = useState(0);
            const [scores, setScores] = useState(new Array(18).fill(0));
            const [startCoords, setStartCoords] = useState(null);
            const [walkedDist, setWalkedDist] = useState(0);
            
            // Load shot history from phone memory
            const [clubData, setClubData] = useState(() => {
                const saved = localStorage.getItem('pngc_club_data');
                return saved ? JSON.parse(saved) : DEFAULT_CLUBS;
            });

            useEffect(() => {
                localStorage.setItem('pngc_club_data', JSON.stringify(clubData));
            }, [clubData]);

            // GPS Tracker Logic
            useEffect(() => {
                let watchId;
                if (startCoords) {
                    watchId = navigator.geolocation.watchPosition((pos) => {
                        const d = calculateDistance(startCoords.lat, startCoords.lon, pos.coords.latitude, pos.coords.longitude);
                        setWalkedDist(Math.round(d));
                    }, null, { enableHighAccuracy: true });
                }
                return () => navigator.geolocation.clearWatch(watchId);
            }, [startCoords]);

            function calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 6371e3; 
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLon = (lon2 - lon1) * Math.PI / 180;
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(lat1 * Math.PI/180) * Math.cos(lat2 * Math.PI/180) * Math.sin(dLon/2) * Math.sin(dLon/2);
                return 2 * R * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            }

            // Suggestion Logic: Uses the best (max) distance in your data
            const getSuggestion = (distRemaining) => {
                const sortedClubs = [...clubData].sort((a, b) => a.dist - b.dist);
                const recommendation = sortedClubs.find(c => c.dist >= distRemaining);
                return recommendation ? recommendation.label : "Driver";
            };

            const handleSaveShot = () => {
                const clubLabel = prompt("Which club did you use?", "7 Iron");
                if (clubLabel) {
                    setClubData(prev => prev.map(c => {
                        // If this shot is better (longer) than your previous best for this club, update it!
                        if (c.label.toLowerCase() === clubLabel.toLowerCase() && walkedDist > c.dist) {
                            alert(`New Personal Best for ${c.label}: ${walkedDist}m!`);
                            return { ...c, dist: walkedDist };
